pipeline {
	agent {
		node {
			label 'cicd_microservice'
		}
	}

  options {
  	ansiColor('xterm')
  }
  tools {
  	maven 'Default' 
    jdk 'Default' 
  }
  stages{
  	stage('checkout'){
  		steps {
  			checkout([$class: 'GitSCM', 
  				branches: [[name: "master"]], 
  				doGenerateSubmoduleConfigurations: 
  				false, extensions: [], submoduleCfg: [], 
  				userRemoteConfigs: 
  				[[url: 'https://github.com/michael-fleming/DevOps']]])
			}
		}
				
  	stage('build'){
 		steps {
 			echo "BUILD STEP"
 		}
  	}

  }
  post {
    always {
		echo "POST BUILD"
    }
	success {
		script {
			withCredentials([usernamePassword(credentialsId: 'github_user', passwordVariable: 'git_password', usernameVariable: 'git_user')]) {
				sh label: 'GIT-Tag', script: '''#!/bin/bash
				
				echo "SUCCESS"
				gitURL=$(git config remote.origin.url | sed 's|^.*//||')
				echo "$gitURL"
				git config user.email "jenkins@bento-tools.org"
				git config user.name "Bento Jenkins"
				git tag --no-sign -a v1.0 -m 'Jenkins tag: v1.1'
				git push https://${git_user}:${git_password}@${gitURL} --tags
				
				'''
			
				}
			}
		
		}
	
  }
}