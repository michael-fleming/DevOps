pipeline {
	agent {
		node {
			label 'cicd_microservice'
		}
	}

  options {
  	ansiColor('xterm')
  }
  tools {
  	maven 'Default' 
    jdk 'Default' 
  }
  stages{
  	stage('checkout'){
  		steps {
  			checkout([$class: 'GitSCM', 
  				branches: [[name: "master"]], 
  				doGenerateSubmoduleConfigurations: 
  				false, extensions: [], submoduleCfg: [], 
  				userRemoteConfigs: 
  				[[url: 'https://github.com/michael-fleming/DevOps']]])
			}
		}
				
  	stage('build'){
 		steps {
 			echo "BUILD STEP"
 		}
  	}

  }
  post {
    always {
		echo "POST BUILD"
    }
	success {
		withCredentials([usernamePassword(credentialsId: 'github_user', passwordVariable: 'git_password', usernameVariable: 'git_user')]) {
			echo "SUCCESS"
			sh "gitURL=$(git config remote.origin.url | sed 's|^.*//||') && urlHEAD='https://' && git tag --no-sign -a v1.0 -m 'Jenkins tag: v1.0' && git push $urlHEAD${git_user}:${git_password}@$gitURL --tags"
			}
		
    }
	
  }
}